<!doctype html>
<html>

  <head>
    <title>Farrukh's chat app</title>
    <link rel="stylesheet" href="style.css" type="text/css">
    <meta charset="UTF-8">
  </head>

  <div className= "scrollBar">
    <ul id="userDisplayed"></ul>
    <body>


      <ul id="messageDisplayed"></ul>
      <form action="">
        <input id="messangeInputID" autocomplete="off" /><button>Send</button>
      </form>
      <script src="/socket.io/socket.io.js"></script>
      <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
      <script>
          $(function () {
            const userid_assignment_event = "1"
            const message_display_event = "2"
            const user_display_event = "3"
            var socket = io();
            let username = ""

            $('form').submit(function(e){ //Executed when pressing enter in the input box
              e.preventDefault(); // prevents page reloading
              let toClient = username + ": " + $('#messangeInputID').val();
              socket.emit('chat message', toClient); //The message that gets sent to the server
              $('#messangeInputID').val(''); //Resets the message box to be blank
              return false; 
            });

            socket.on('chat message', function(fromServer){ //Receives string from server
              let eventType = getFirstWord(fromServer);
              let content = removeFirstWord(fromServer)
              if (eventType == userid_assignment_event){
                username = content;
                let toDisplay = "Welcome " + username
                $('#messageDisplayed').append($('<li>').text(toDisplay)); //Appends the message to contain the message text
              }
              else if (eventType == message_display_event){
                let toDisplay = content
                $('#messageDisplayed').append($('<li>').text(toDisplay)); //Appends the message to contain the message text
              }
              else if (eventType == user_display_event){
                let toDisplay = content;
                $('#userDisplayed').append($('<li>').text(toDisplay));
              }
            });
          });

          function getFirstWord(words){
            var firstWord = words.split(" ")[0]
            return firstWord;
          }

          function removeFirstWord(words){
            var result = words.substr(words.indexOf(" ") + 1);
            return result;
          }
        </script>
    </body>
</div>


</html>